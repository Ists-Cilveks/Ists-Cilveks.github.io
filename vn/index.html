<!DOCTYPE html>
<html>
	<head>
		<title>TEST TEST TEST</title>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link href="/css/style.css" rel="stylesheet">
		<link href="vn.css" rel="stylesheet">
	</head>
	<body class="main-content">
	
	<script src="/js/Color.js"></script>
	<script src="/css/palettize.js"></script>
	<script src="/js/particles.js"></script>
	<script src="/js/SVGRequests.js"></script>
	
  <header id="main-header">
  </header>
  <script src="/js/languages.js" my-languges="en"></script>

  <div id="vn-textbox" onclick="progressText()">
    <p>Click to progress the text. This likely won't work with screen readers.</p>
  </div>

  <div id="all-vn-content" style="display: none;"></div>

  <div id="proto-container"></div>

  <script type="text/javascript">
    const textbox = document.getElementById('vn-textbox')
    const allContent = document.getElementById('all-vn-content')
    let currentContent
    let contentDiv

    const xhr = new XMLHttpRequest();
    xhr.open("GET", "test.html", true);
    xhr.responseType = "document";
    xhr.onload = function(e) {
      let myDoc = xhr.responseXML.documentElement
      allContent.appendChild(myDoc)
      contentDiv = document.getElementById("vn-content").firstElementChild
    };
    xhr.send("");

    const protoContainer = document.getElementById('proto-container')
    insertSVG("proto/proto.svg", protoContainer)
    let currentProtoEmotion = "proto-neutral"
    
    
    function progressText() {
      // Get next element
      let newContent = contentDiv.firstElementChild
      if (!newContent) {
        newContentDiv = contentDiv.nextElementSibling
        if(!newContentDiv) { // out of content
          return
        }
        contentDiv = newContentDiv
        newContent = contentDiv.firstElementChild
      }

      // Replace
      textbox.textContent = ""
      textbox.appendChild(newContent)
      currentContent = newContent

      // Look for expressions
      const classes = currentContent.className.split(' ')
      let emotion
      for (const cl of classes) {
        if (cl.startsWith("proto-")) {
          emotion = cl
          break
        }
      }
      if (emotion) {
        document.getElementById(currentProtoEmotion).style.display = "none"
        document.getElementById(emotion).style.display = "inline"
        currentProtoEmotion = emotion
      }
    }
  </script>
	</body>
</html>